"use strict";(globalThis["webpackChunkquasagram"]=globalThis["webpackChunkquasagram"]||[]).push([[735],{7735:(a,e,t)=>{t.r(e),t.d(e,{default:()=>I});var o=t(9835),i=t(1957);const l={class:"camera-frame q-pa-md"},n={ref:"video",class:"full-width",autoplay:""},s={ref:"canvas",class:"full-width",height:"240"},d={class:"text-center q-pa-md"},r={class:"row justify-center q-ma-md"},c={class:"row justify-center q-ma-md"},p={class:"row justify-center q-mt-lg"};function u(a,e,t,u,g,h){const m=(0,o.up)("q-btn"),v=(0,o.up)("q-icon"),w=(0,o.up)("q-file"),b=(0,o.up)("q-input"),C=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(C,{class:"constraint-more q-pa-md"},{default:(0,o.w5)((()=>[(0,o._)("div",l,[(0,o.wy)((0,o._)("video",n,null,512),[[i.F8,!g.imageCaptured]]),(0,o.wy)((0,o._)("canvas",s,null,512),[[i.F8,g.imageCaptured]])]),(0,o._)("div",d,[g.hasCameraSupport?((0,o.wg)(),(0,o.j4)(m,{key:0,onClick:h.captureImage,disable:g.imageCaptured,modelValue:g.post.caption,"onUpdate:modelValue":e[0]||(e[0]=a=>g.post.caption=a),color:"grey-10",icon:"eva-camera",size:"lg",round:""},null,8,["onClick","disable","modelValue"])):((0,o.wg)(),(0,o.j4)(w,{key:1,outlined:"",modelValue:g.imageUpload,"onUpdate:modelValue":e[1]||(e[1]=a=>g.imageUpload=a),label:"Escolha a imagem",onInput:h.captureImageFallback,accept:"image/*"},{prepend:(0,o.w5)((()=>[(0,o.Wm)(v,{name:"eva-attach-outline"})])),_:1},8,["modelValue","onInput"])),(0,o._)("div",r,[(0,o.Wm)(b,{modelValue:g.post.caption,"onUpdate:modelValue":e[2]||(e[2]=a=>g.post.caption=a),class:"col",label:"Título *",dense:""},null,8,["modelValue"])]),(0,o._)("div",c,[(0,o.Wm)(b,{modelValue:g.post.location,"onUpdate:modelValue":e[3]||(e[3]=a=>g.post.location=a),loading:g.locationLoading,class:"col",label:"Localização",dense:""},{append:(0,o.w5)((()=>[!g.locationLoading&&h.locationSupported?((0,o.wg)(),(0,o.j4)(m,{key:0,onClick:h.getLocation,round:"",dense:"",flat:"",icon:"eva-navigation-2-outline"},null,8,["onClick"])):(0,o.kq)("",!0)])),_:1},8,["modelValue","loading"])]),(0,o._)("div",p,[(0,o.Wm)(m,{onClick:e[4]||(e[4]=a=>h.addPost()),disable:!g.post.caption||!g.post.location,unelevated:"",rounded:"",color:"primary",label:"Publicar Imagem"},null,8,["disable"])])])])),_:1})}t(6204),t(8170),t(5231),t(7725),t(9359),t(6408),t(940),t(3667);var g=t(796);t(8419);const h={name:"CameraPage",data(){return{post:{id:(0,g.Z)(),caption:"",location:"",photo:null,date:Date.now()},imageCaptured:!1,imageUpload:[],hasCameraSupport:!0,locationLoading:!1}},computed:{locationSupported(){return"geolocation"in navigator}},methods:{initCamera(){navigator.mediaDevices.getUserMedia({video:!0}).then((a=>{this.$refs.video.srcObject=a})).catch((a=>{this.hasCameraSupport=!1}))},captureImage(){let a=this.$refs.video,e=this.$refs.canvas;e.width=a.getBoundingClientRect().width,e.height=a.getBoundingClientRect().height,e.getContext("2d").drawImage(a,0,0,e.width,e.height),this.imageCaptured=!0,this.post.photo=this.dataURItoBlob(e.toDataURL()),this.disableCamera()},captureImageFallback(a){let e=this.$refs.canvas,t=e.getContext("2d");this.post.photo=a;var o=new FileReader;o.onload=i=>{var l=new Image;l.onload=()=>{i.target.readyState==FileReader.DONE&&(l.src=i.target.result,t.drawImage(l,0,0,e.width,e.height),this.imageCaptured=!0)},o.readAsDataURL(this.dataURItoBlob(a.toDataURL))}},disableCamera(){this.$refs.video.srcObject.getVideoTracks().forEach((a=>a.stop()))},getLocation(){this.locationLoading=!0,navigator.geolocation&&navigator.geolocation.getCurrentPosition((a=>{let e="https://geocode.xyz/"+a.coords.latitude+","+a.coords.longitude+"?json=1&auth=332048993145334419283x71227";fetch(e).then((a=>a.json())).then((a=>{this.post.location=a.city+", "+a.country}))})),this.locationLoading=!1},dataURItoBlob(a){for(var e=atob(a.split(",")[1]),t=a.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),i=new Uint8Array(o),l=0;l<e.length;l++)i[l]=e.charCodeAt(l);var n=new Blob([o],{type:t});return n},addPost(){let a=new FormData;a.append("id",this.post.id),a.append("caption",this.post.caption),a.append("location",this.post.location),a.append("date",this.post.date),a.append("file",this.post.photo,this.post.id+".png"),this.$axios.post("https://quasagram-inc.herokuapp.com/createPost",a).then((a=>{console.log(a),this.$router.push("/"),this.$q.notify({message:"Publicação realizada com sucesso",actions:[{label:"Fechar",color:"white"}]})})).catch((a=>{console.log("Erro: "+a),this.$q.dialog({title:"Erro",message:"Ocorreu um erro ao publicar seu post, tente novamente mais tarde"})}))}},mounted(){this.initCamera()}};var m=t(1639),v=t(9885),w=t(4455),b=t(3171),C=t(2857),f=t(4152),y=t(9984),k=t.n(y);const q=(0,m.Z)(h,[["render",u]]),I=q;k()(h,"components",{QPage:v.Z,QBtn:w.Z,QFile:b.Z,QIcon:C.Z,QInput:f.Z})}}]);